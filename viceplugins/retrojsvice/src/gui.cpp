#include "gui.hpp"

namespace retrojsvice {

namespace {

vector<string> createUploadModeWidget() {
    vector<string> ret;
    auto add = [&](int count, const string& line) {
        for(int i = 0; i < count; ++i) {
            ret.push_back(move(line));
        }
    };
    add(26, ".W.....................................................................................................................................................................................................................................................G#");
    add( 1, ".W.................................#..........................#.............#......................#............#..............##.#..#...........................#....................#............................#...................................G#");
    add( 1, ".W.........................#######.#........................................#.................................................#......#...........................#....................#............................#...................................G#");
    add( 1, ".W............................#....#........................................#.................................................#......#...........................#....................#............................#...................................G#");
    add( 1, ".W............................#....####....###.......#..#..#..#..####....####...###...#..#..#......#...###......#..####......####.#..#...###.......#...#..####...#...###....###....####......####.###....###....####...###.............................G#");
    add( 1, ".W............................#....#...#..#...#......#..#..#..#..#...#..#...#..#...#..#..#..#......#..#.........#..#...#......#...#..#..#...#......#...#..#...#..#..#...#......#..#...#......#...#...#..#...#..#...#..#...#............................G#");
    add( 1, ".W............................#....#...#..#####......#.#.#.#..#..#...#..#...#..#...#..#.#.#.#......#..##........#..#...#......#...#..#..#####......#...#..#...#..#..#...#...####..#...#......#...#...#..#...#..#...#..#####............................G#");
    add( 1, ".W............................#....#...#..#..........#.#.#.#..#..#...#..#...#..#...#..#.#.#.#......#....##......#..#...#......#...#..#..#..........#...#..#...#..#..#...#..#...#..#...#......#...#...#..#...#..#...#..#................................G#");
    add( 1, ".W............................#....#...#..#...#.......#...#...#..#...#..#...#..#...#...#...#.......#.....#......#..#...#......#...#..#..#...#......#...#..#...#..#..#...#..#...#..#...#......#...#...#..#...#..#...#..#...#...#........................G#");
    add( 1, ".W............................#....#...#...###........#...#...#..#...#...####...###....#...#.......#..###.......#..#...#......#...#..#...###........####..####...#...###....####...####......#...#...#...###....####...###....#........................G#");
    add( 1, ".W........................................................................................................................................................#............................................................................................G#");
    add( 1, ".W........................................................................................................................................................#............................................................................................G#");
    add( 6, ".W.....................................................................................................................................................................................................................................................G#");
    add( 1, ".W.................................................................#.....................................................................................#....................#..................##.#..#...............................................G#");
    add( 1, ".W....................................#....#...................#...#........................................................#............................#....................#.................#......#...............................................G#");
    add( 1, ".W....................................#....#...................#...#........................................................#............................#....................#.................#......#...............................................G#");
    add( 1, ".W....................................#....#...###...###......####.####....###.......####....###...####...#...#..####......####..###.......#...#..####...#...###....###....####.......###......####.#..#...###.........................................G#");
    add( 1, ".W....................................#....#..#.....#...#......#...#...#..#...#......#...#..#...#..#...#..#...#..#...#......#...#...#......#...#..#...#..#..#...#......#..#...#..........#......#...#..#..#...#........................................G#");
    add( 1, ".W....................................#....#..##....#####......#...#...#..#####......#...#..#...#..#...#..#...#..#...#......#...#...#......#...#..#...#..#..#...#...####..#...#.......####......#...#..#..#####........................................G#");
    add( 1, ".W....................................#....#....##..#..........#...#...#..#..........#...#..#...#..#...#..#...#..#...#......#...#...#......#...#..#...#..#..#...#..#...#..#...#......#...#......#...#..#..#............................................G#");
    add( 1, ".W....................................#....#.....#..#...#......#...#...#..#...#......#...#..#...#..#...#..#...#..#...#......#...#...#......#...#..#...#..#..#...#..#...#..#...#......#...#......#...#..#..#...#...#....................................G#");
    add( 1, ".W.....................................####...###....###........##.#...#...###.......####....###...####....####..####........##..###........####..####...#...###....####...####.......####......#...#..#...###....#....................................G#");
    add( 1, ".W...................................................................................#.............#.............#................................#....................................................................................................G#");
    add( 1, ".W...................................................................................#.............#.............#................................#....................................................................................................G#");
    add(24, ".W.....................................................................................................................................................................................................................................................G#");
    add( 1, ".W....................................................................................AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB....................................................................................G#");
    add( 1, ".W....................................................................................ACCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCDB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.....................................................x...................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC....................xxxx.............................x+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC...................x.+++*............................x+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC..................x.+....+.xxx...xxxx....xxx...xxx...x+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC..................x+........++*..x+++*..x.++*.x.++*..x+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC..................x+.......xxxx+.x+..x+.x+...+x*xxx+.x+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC..................x+......x.++*+.x+..x+.x+....x+++++.x+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC...................*....x.x+..x+.x+..x+.x+..x.x+..x..x+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC....................*xxx.+.*xxx+.x+..x+..*xx.+.*xx.+.x+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.....................++++...++++..+...+...+++...+++...+..................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................AC.........................................................................DB....................................................................................G#");
    add( 1, ".W....................................................................................ADDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDDB....................................................................................G#");
    add( 1, ".W....................................................................................BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB....................................................................................G#");
    add(16, ".W.....................................................................................................................................................................................................................................................G#");
    add( 1, ".GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG#");
    add( 1, "#########################################################################################################################################################################################################################################################");
    return ret;
}

vector<string> uploadModeWidget = createUploadModeWidget();

size_t uploadModeWidgetPos(size_t width) {
    size_t widgetWidth = 0;
    if(!uploadModeWidget.empty()) {
        widgetWidth = uploadModeWidget[0].size();
    }
    return (width - min(widgetWidth, width)) / 2;
}

}

void renderUploadModeGUI(
    vector<uint8_t>& data,
    size_t width,
    size_t height,
    bool cancelButtonDown
) {
    REQUIRE(data.size() >= 4 * width * height);

    for(uint8_t& val : data) {
        val = (val >> 1) | (uint8_t)0x80;
    }

    int colors[256] = {};
    colors[(int)'.'] = 0xC0C0C0;
    colors[(int)'W'] = 0xFFFFFF;
    colors[(int)'G'] = 0x808080;
    colors[(int)'#'] = 0x000000;

    if(cancelButtonDown) {
        colors[(int)'A'] = 0x808080;
        colors[(int)'B'] = 0xFFFFFF;
        colors[(int)'C'] = 0x000000;
        colors[(int)'D'] = 0xC0C0C0;

        colors[(int)'+'] = 0x000000;
        colors[(int)'*'] = 0x000000;
        colors[(int)'x'] = 0xC0C0C0;
    } else {
        colors[(int)'A'] = 0xFFFFFF;
        colors[(int)'B'] = 0x000000;
        colors[(int)'C'] = 0xC0C0C0;
        colors[(int)'D'] = 0x808080;

        colors[(int)'+'] = 0xC0C0C0;
        colors[(int)'*'] = 0x000000;
        colors[(int)'x'] = 0x000000;
    }

    size_t widgetPos = uploadModeWidgetPos(width);
    for(size_t y = 0; y < uploadModeWidget.size(); ++y) {
        size_t x = widgetPos;
        for(char ch : uploadModeWidget[y]) {
            if(x < width && y < height) {
                int color = colors[(uint8_t)ch];
                uint8_t b = (uint8_t)(color & 0xFF);
                color >>= 8;
                uint8_t g = (uint8_t)(color & 0xFF);
                color >>= 8;
                uint8_t r = (uint8_t)(color & 0xFF);
                uint8_t* pos = &data[4 * (y * width + x)];
                *pos++ = r;
                *pos++ = g;
                *pos++ = b;
            }

            ++x;
        }
    }
}

bool isOverUploadModeCancelButton(
    size_t x, size_t y, size_t width, size_t height
) {
    size_t widgetPos = uploadModeWidgetPos(width);
    size_t x1 = widgetPos + 86;
    size_t x2 = x1 + 77;
    size_t y1 = 78;
    size_t y2 = y1 + 23;
    return x >= x1 && x < x2 && y >= y1 && y < y2;
}

}
